<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargador de Documentos - Planificación Académica</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #2ecc71;
            --warning: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .description {
            max-width: 800px;
            margin: 0 auto;
            font-size: 16px;
        }
        
        .upload-section {
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .upload-card {
            background: var(--light);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px dashed #ccc;
        }
        
        .upload-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--secondary);
        }
        
        .upload-card h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .file-info {
            font-size: 13px;
            color: #666;
            margin: 10px 0;
            min-height: 40px;
        }
        
        .btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            display: inline-block;
            margin-top: 10px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-danger {
            background-color: var(--accent);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .progress-container {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--secondary);
            width: 0%;
            transition: width 0.3s;
        }
        
        .status {
            margin-top: 15px;
            font-weight: 600;
        }
        
        .status.success {
            color: var(--success);
        }
        
        .status.error {
            color: var(--accent);
        }
        
        .actions {
            padding: 20px;
            text-align: center;
            background: #f9f9f9;
            border-top: 1px solid #eee;
        }
        
        .preview-section {
            padding: 20px;
            display: none;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .preview-table th, .preview-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .preview-table th {
            background-color: var(--primary);
            color: white;
        }
        
        .preview-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .preview-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--primary);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-bottom: 5px;
                border-radius: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Cargador de Documentos Excel</h1>
            <p class="description">Cargue los archivos Excel necesarios para el sistema de planificación académica. Los archivos requeridos son: Docentes.xlsx, Mallas.xlsx, Estudiantes.xlsx y PLANIFICACIÓN - DOCENTES.xlsx</p>
        </header>
        
        <div class="upload-section">
            <div class="upload-card">
                <h3>Docentes.xlsx</h3>
                <p>Archivo con la información de los docentes y su disponibilidad</p>
                <div class="file-info" id="fileInfo1">No se ha cargado ningún archivo</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress1"></div>
                </div>
                <div class="status" id="status1"></div>
                <input type="file" id="file1" accept=".xlsx, .xls" style="display: none;">
                <button class="btn" onclick="document.getElementById('file1').click()">Seleccionar Archivo</button>
            </div>
            
            <div class="upload-card">
                <h3>Mallas.xlsx</h3>
                <p>Archivo con las mallas curriculares de las carreras</p>
                <div class="file-info" id="fileInfo2">No se ha cargado ningún archivo</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress2"></div>
                </div>
                <div class="status" id="status2"></div>
                <input type="file" id="file2" accept=".xlsx, .xls" style="display: none;">
                <button class="btn" onclick="document.getElementById('file2').click()">Seleccionar Archivo</button>
            </div>
            
            <div class="upload-card">
                <h3>Estudiantes.xlsx</h3>
                <p>Archivo con la información de los estudiantes</p>
                <div class="file-info" id="fileInfo3">No se ha cargado ningún archivo</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress3"></div>
                </div>
                <div class="status" id="status3"></div>
                <input type="file" id="file3" accept=".xlsx, .xls" style="display: none;">
                <button class="btn" onclick="document.getElementById('file3').click()">Seleccionar Archivo</button>
            </div>
            
            <div class="upload-card">
                <h3>PLANIFICACIÓN - DOCENTES.xlsx</h3>
                <p>Archivo con la planificación docente</p>
                <div class="file-info" id="fileInfo4">No se ha cargado ningún archivo</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress4"></div>
                </div>
                <div class="status" id="status4"></div>
                <input type="file" id="file4" accept=".xlsx, .xls" style="display: none;">
                <button class="btn" onclick="document.getElementById('file4').click()">Seleccionar Archivo</button>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn btn-success" id="processBtn" disabled>Procesar Archivos</button>
            <button class="btn btn-danger" id="resetBtn">Reiniciar</button>
        </div>
        
        <div class="preview-section" id="previewSection">
            <h2>Vista Previa de Datos Cargados</h2>
            
            <div class="tabs">
                <div class="tab active" data-tab="docentes">Docentes</div>
                <div class="tab" data-tab="mallas">Mallas</div>
                <div class="tab" data-tab="estudiantes">Estudiantes</div>
                <div class="tab" data-tab="planificacion">Planificación</div>
            </div>
            
            <div class="tab-content active" id="docentes">
                <h3>Datos de Docentes (Primeras 5 filas)</h3>
                <div class="table-container">
                    <table class="preview-table" id="previewDocentes">
                        <thead>
                            <tr>
                                <th>Nombre Docente</th>
                                <th>Dedicación</th>
                                <th>Materia</th>
                                <th>Día Disponible</th>
                                <th>Hora Disponible</th>
                                <th>Modalidad</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se insertarán aquí mediante JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-content" id="mallas">
                <h3>Datos de Mallas (Primeras 5 filas)</h3>
                <div class="table-container">
                    <table class="preview-table" id="previewMallas">
                        <thead>
                            <tr>
                                <th>Carrera</th>
                                <th>Malla</th>
                                <th>Ciclo</th>
                                <th>Materia</th>
                                <th>Código</th>
                                <th>Créditos</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se insertarán aquí mediante JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-content" id="estudiantes">
                <h3>Datos de Estudiantes (Primeras 5 filas)</h3>
                <div class="table-container">
                    <table class="preview-table" id="previewEstudiantes">
                        <thead>
                            <tr>
                                <th>Estudiante</th>
                                <th>Carrera</th>
                                <th>Malla</th>
                                <th>Ciclo Actual</th>
                                <th>Próximo Ciclo</th>
                                <th>Nivel Inglés</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se insertarán aquí mediante JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-content" id="planificacion">
                <h3>Datos de Planificación (Primeras 5 filas)</h3>
                <div class="table-container">
                    <table class="preview-table" id="previewPlanificacion">
                        <thead>
                            <tr>
                                <th>Docente</th>
                                <th>Dedicación</th>
                                <th>Materia</th>
                                <th>Código</th>
                                <th>Carreras</th>
                                <th>Créditos</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se insertarán aquí mediante JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales para almacenar los datos
        let docentesData = [];
        let mallasData = [];
        let estudiantesData = [];
        let planificacionData = [];
        
        // Referencias a elementos del DOM
        const fileInputs = [
            document.getElementById('file1'),
            document.getElementById('file2'),
            document.getElementById('file3'),
            document.getElementById('file4')
        ];
        
        const fileInfos = [
            document.getElementById('fileInfo1'),
            document.getElementById('fileInfo2'),
            document.getElementById('fileInfo3'),
            document.getElementById('fileInfo4')
        ];
        
        const progressBars = [
            document.getElementById('progress1'),
            document.getElementById('progress2'),
            document.getElementById('progress3'),
            document.getElementById('progress4')
        ];
        
        const statuses = [
            document.getElementById('status1'),
            document.getElementById('status2'),
            document.getElementById('status3'),
            document.getElementById('status4')
        ];
        
        const processBtn = document.getElementById('processBtn');
        const resetBtn = document.getElementById('resetBtn');
        const previewSection = document.getElementById('previewSection');
        
        // Configurar event listeners para los inputs de archivo
        fileInputs.forEach((input, index) => {
            input.addEventListener('change', (event) => {
                handleFileSelect(event, index);
            });
        });
        
        // Event listener para el botón de procesar
        processBtn.addEventListener('click', processFiles);
        
        // Event listener para el botón de reiniciar
        resetBtn.addEventListener('click', resetAll);
        
        // Configurar tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                
                // Desactivar todas las pestañas
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                
                // Activar la pestaña seleccionada
                tab.classList.add('active');
                document.getElementById(tabName).classList.add('active');
            });
        });
        
        // Función para manejar la selección de archivos
        function handleFileSelect(event, index) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Actualizar información del archivo
            fileInfos[index].textContent = `Archivo: ${file.name} (${formatFileSize(file.size)})`;
            statuses[index].textContent = 'Leyendo archivo...';
            statuses[index].className = 'status';
            
            // Simular progreso
            simulateProgress(progressBars[index], () => {
                // Leer el archivo Excel
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        // Procesar según el tipo de archivo
                        switch(index) {
                            case 0:
                                docentesData = processWorkbook(workbook);
                                statuses[index].textContent = `Cargado: ${docentesData.length} registros`;
                                break;
                            case 1:
                                mallasData = processWorkbook(workbook);
                                statuses[index].textContent = `Cargado: ${mallasData.length} registros`;
                                break;
                            case 2:
                                estudiantesData = processWorkbook(workbook);
                                statuses[index].textContent = `Cargado: ${estudiantesData.length} registros`;
                                break;
                            case 3:
                                planificacionData = processWorkbook(workbook);
                                statuses[index].textContent = `Cargado: ${planificacionData.length} registros`;
                                break;
                        }
                        
                        statuses[index].className = 'status success';
                        
                        // Verificar si todos los archivos están cargados
                        checkAllFilesLoaded();
                    } catch (error) {
                        statuses[index].textContent = 'Error: ' + error.message;
                        statuses[index].className = 'status error';
                    }
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Función para procesar el workbook de Excel
        function processWorkbook(workbook) {
            let allData = [];
            
            // Iterar sobre cada hoja
            workbook.SheetNames.forEach(sheetName => {
                const worksheet = workbook.Sheets[sheetName];
                const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                // Si hay datos, procesarlos
                if (data.length > 0) {
                    // Obtener headers (primera fila)
                    const headers = data[0];
                    
                    // Procesar filas de datos
                    for (let i = 1; i < data.length; i++) {
                        if (data[i].length > 0) {
                            const rowData = {};
                            for (let j = 0; j < headers.length; j++) {
                                if (headers[j] && data[i][j] !== undefined) {
                                    rowData[headers[j]] = data[i][j];
                                }
                            }
                            allData.push(rowData);
                        }
                    }
                }
            });
            
            return allData;
        }
        
        // Función para simular progreso de carga
        function simulateProgress(progressBar, callback) {
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                    callback();
                } else {
                    width += 5;
                    progressBar.style.width = width + '%';
                }
            }, 50);
        }
        
        // Función para verificar si todos los archivos están cargados
        function checkAllFilesLoaded() {
            const allLoaded = fileInputs.every(input => input.files.length > 0);
            processBtn.disabled = !allLoaded;
        }
        
        // Función para procesar todos los archivos
        function processFiles() {
            // Mostrar la sección de vista previa
            previewSection.style.display = 'block';
            
            // Mostrar datos en las tablas de vista previa
            showPreviewData(docentesData, 'previewDocentes', ['NOMBRE_DOCENTE', 'DEDICACION', 'MATERIA', 'DIA DISPONIBLE', 'HORA DISPONIBLE', 'Modalidad']);
            showPreviewData(mallasData, 'previewMallas', ['CARRERA', 'MALLA', 'CICLO', 'MATERIA', 'CÓDIGO', 'CRÉDITOS']);
            showPreviewData(estudiantesData, 'previewEstudiantes', ['ESTUDIANTE', 'CARRERA', 'MALLA', 'CICLO ACTUAL', 'CICLO AL QUE VA', 'NIVEL DE INGLES']);
            showPreviewData(planificacionData, 'previewPlanificacion', ['DOCENTE', 'DEDICACIÓN', 'MATERIA', 'CÓDIGO ANTHOLOGY', 'CARRERAS QUE COMPARTEN', 'CREDITOS']);
            
            // Desplazarse a la sección de vista previa
            previewSection.scrollIntoView({ behavior: 'smooth' });
            
            // Aquí se pueden realizar más operaciones con los datos cargados
            console.log('Datos de docentes:', docentesData);
            console.log('Datos de mallas:', mallasData);
            console.log('Datos de estudiantes:', estudiantesData);
            console.log('Datos de planificación:', planificacionData);
            
            alert('Archivos procesados correctamente. Los datos están listos para ser utilizados en el sistema de planificación.');
        }
        
        // Función para mostrar datos de vista previa en una tabla
        function showPreviewData(data, tableId, columns) {
            const table = document.getElementById(tableId);
            // Limpiar el cuerpo de la tabla
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }
            
            // Agregar hasta 5 filas de datos
            for (let i = 0; i < Math.min(5, data.length); i++) {
                const row = table.insertRow();
                columns.forEach(column => {
                    const cell = row.insertCell();
                    cell.textContent = data[i][column] || '';
                });
            }
        }
        
        // Función para reiniciar todo
        function resetAll() {
            // Reiniciar inputs de archivo
            fileInputs.forEach(input => {
                input.value = '';
            });
            
            // Reiniciar información de archivos
            fileInfos.forEach(info => {
                info.textContent = 'No se ha cargado ningún archivo';
            });
            
            // Reiniciar barras de progreso
            progressBars.forEach(bar => {
                bar.style.width = '0%';
            });
            
            // Reiniciar estados
            statuses.forEach(status => {
                status.textContent = '';
                status.className = 'status';
            });
            
            // Deshabilitar botón de procesar
            processBtn.disabled = true;
            
            // Ocultar sección de vista previa
            previewSection.style.display = 'none';
            
            // Reiniciar datos
            docentesData = [];
            mallasData = [];
            estudiantesData = [];
            planificacionData = [];
        }
        
        // Función para formatear el tamaño del archivo
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
