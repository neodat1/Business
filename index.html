<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Horarios Académicos - UIDE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --azul: #04136C;
            --mostaza: #DE912E;
            --vino: #862B39;
            --celeste: #9CBEE3;
            --verde: #8A9520;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--azul);
            color: white;
            padding: 15px 0;
            text-align: center;
            border-bottom: 5px solid var(--mostaza);
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo {
            max-height: 80px;
        }
        
        h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .upload-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .file-input {
            margin-bottom: 15px;
        }
        
        button {
            background-color: var(--azul);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--vino);
        }
        
        .schedule-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        th {
            background-color: var(--azul);
            color: white;
        }
        
        .time-header {
            background-color: var(--celeste);
        }
        
        .course-cell {
            background-color: var(--mostaza);
            color: white;
            font-weight: bold;
            border-radius: 4px;
        }
        
        .parallel-cell {
            background-color: var(--verde);
            color: white;
        }
        
        .error {
            color: red;
            margin-top: 10px;
        }
        
        .success {
            color: green;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="UIDE-Ecuador.png" alt="UIDE Ecuador" class="logo" id="logoPlaceholder">
        </div>
        <h1>Generador de Horarios Académicos</h1>
    </header>
    
    <div class="container">
        <div class="upload-section">
            <h2>Cargar datos de horarios</h2>
            <input type="file" id="excelFile" class="file-input" accept=".xlsx, .xls">
            <button onclick="processExcel()">Generar Horarios</button>
            <div id="message"></div>
        </div>
        
        <div class="schedule-container">
            <h2>Horarios Generados</h2>
            <div id="schedule"></div>
        </div>
    </div>

    <script>
        // Función para procesar el archivo Excel
        function processExcel() {
            const fileInput = document.getElementById('excelFile');
            const messageDiv = document.getElementById('message');
            const scheduleDiv = document.getElementById('schedule');
            
            if (!fileInput.files.length) {
                messageDiv.innerHTML = '<p class="error">Por favor, seleccione un archivo Excel.</p>';
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Suponiendo que la primera hoja contiene los datos
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    // Procesar datos y generar horarios
                    const schedules = generateSchedules(jsonData);
                    
                    // Mostrar horarios
                    displaySchedules(schedules);
                    
                    messageDiv.innerHTML = '<p class="success">Horarios generados exitosamente.</p>';
                } catch (error) {
                    console.error(error);
                    messageDiv.innerHTML = '<p class="error">Error al procesar el archivo: ' + error.message + '</p>';
                }
            };
            
            reader.onerror = function() {
                messageDiv.innerHTML = '<p class="error">Error al leer el archivo.</p>';
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // Función para generar horarios evitando cruces
        function generateSchedules(data) {
            // Esta es una implementación simplificada
            // En una aplicación real, aquí implementarías la lógica completa de asignación
            
            const timeSlots = [
                '07:00-10:00', 
                '10:00-13:00', 
                '13:00-16:00', 
                '16:00-19:00', 
                '19:00-22:00'
            ];
            
            const days = ['LUNES', 'MARTES', 'MIÉRCOLES', 'JUEVES', 'VIERNES'];
            
            // Estructura para almacenar los horarios
            const schedules = {
                'Primer Ciclo': createEmptySchedule(days, timeSlots),
                'Segundo Ciclo': createEmptySchedule(days, timeSlots),
                'Tercer Ciclo': createEmptySchedule(days, timeSlots),
                'Cuarto Ciclo': createEmptySchedule(days, timeSlots),
                'Quinto Ciclo': createEmptySchedule(days, timeSlots)
            };
            
            // Aquí iría la lógica compleja para asignar materias a horarios
            // evitando cruces y considerando todas las restricciones
            
            // Por ahora, solo mostraremos un ejemplo estático
            return schedules;
        }
        
        // Crear horario vacío
        function createEmptySchedule(days, timeSlots) {
            const schedule = {};
            days.forEach(day => {
                schedule[day] = {};
                timeSlots.forEach(time => {
                    schedule[day][time] = null;
                });
            });
            return schedule;
        }
        
        // Mostrar horarios en la interfaz
        function displaySchedules(schedules) {
            let html = '';
            
            for (const [cycle, schedule] of Object.entries(schedules)) {
                html += `<h3>${cycle}</h3>`;
                html += generateScheduleTable(schedule);
            }
            
            document.getElementById('schedule').innerHTML = html;
        }
        
        // Generar tabla de horario
        function generateScheduleTable(scheduleData) {
            const days = ['LUNES', 'MARTES', 'MIÉRCOLES', 'JUEVES', 'VIERNES'];
            const timeSlots = [
                '07:00-10:00', 
                '10:00-13:00', 
                '13:00-16:00', 
                '16:00-19:00', 
                '19:00-22:00'
            ];
            
            let tableHTML = '<table><tr><th>Hora/Día</th>';
            
            // Encabezados de días
            days.forEach(day => {
                tableHTML += `<th>${day}</th>`;
            });
            
            tableHTML += '</tr>';
            
            // Filas para cada franja horaria
            timeSlots.forEach(time => {
                tableHTML += `<tr><td class="time-header">${time}</td>`;
                
                days.forEach(day => {
                    const course = scheduleData[day][time];
                    tableHTML += '<td>';
                    
                    if (course) {
                        tableHTML += `<div class="course-cell">${course.subject}</div>`;
                        tableHTML += `<div>${course.teacher}</div>`;
                        tableHTML += `<div class="parallel-cell">Paralelo: ${course.parallel}</div>`;
                    }
                    
                    tableHTML += '</td>';
                });
                
                tableHTML += '</tr>';
            });
            
            tableHTML += '</table>';
            return tableHTML;
        }
        
        // Manejar la visualización del logo
        document.getElementById('logoPlaceholder').onerror = function() {
            this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iODAiIGZpbGw9IiMwNDEzNkMiLz48dGV4dCB4PSIxMCIgeT0iNDUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiPlVJREUgRWN1YWRvcjwvdGV4dD48L3N2Zz4=';
        };
    </script>
</body>
</html>
