
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Matriz Académica</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; font-size: 12px; }
        th, td { border: 1px solid #999; padding: 6px; text-align: center; }
        th { background-color: #f2f2f2; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h2>Cargar archivos Excel: Mallas y Docentes</h2>
    <input type="file" id="mallaFile" accept=".xlsx" />
    <input type="file" id="docentesFile" accept=".xlsx" />
    <button onclick="procesar()">Procesar Archivos</button>
    <div id="tablaContainer"></div>

<script>
function leerExcel(file, callback) {
    const reader = new FileReader();
    reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const hoja = workbook.SheetNames[0];
        const json = XLSX.utils.sheet_to_json(workbook.Sheets[hoja], { defval: "" });
        callback(json);
    };
    reader.readAsArrayBuffer(file);
}

function procesar() {
    const archivoMalla = document.getElementById('mallaFile').files[0];
    const archivoDocente = document.getElementById('docentesFile').files[0];
    if (!archivoMalla || !archivoDocente) {
        alert("Cargue ambos archivos");
        return;
    }

    leerExcel(archivoMalla, function(mallaData) {
        leerExcel(archivoDocente, function(docentesData) {
            const horariosDisponibles = [
                "07:00–10:00", "10:00–13:00", "13:00–16:00", "16:00–19:00", "19:00–22:00"
            ];
            const dias = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes"];
            let asignados = {}; // Para evitar choques

            let tablaHTML = `<table><thead><tr>
                <th>DOCENTE</th><th>TÍTULO ACADÉMICO</th><th>DEDICACIÓN</th><th>MATERIA</th><th>CÓDIGO ANTHOLOGY</th>
                <th>CARRERAS QUE COMPARTEN</th><th>MALLA</th><th>PRE-REQUISITO</th><th>CÓDIGO</th>
                <th>HORAS TEÓRICAS</th><th>HORAS PRÁCTICAS</th><th>HORAS AUTÓNOMAS</th><th>CRÉDITOS</th>
                <th>CAMPO DE FORMACIÓN</th><th>CICLO MALLA</th><th>Nº ORDEN EN LA MALLA</th>
                <th>PARALELO</th><th>DÍA</th><th>HORA</th><th>MODALIDAD</th><th>Nro. HORAS</th>
            </tr></thead><tbody>`;

            mallaData.forEach((fila, index) => {
                const materia = fila["MATERIA"].trim().toUpperCase();
                const docentes = docentesData.filter(d => d["MATERIA"].trim().toUpperCase() === materia);
                const docente = docentes.length > 0 ? docentes[0] : { "DOCENTE": "NO ASIGNADO", "TITULO ACADÉMICO": "", "DEDICACION": "", "DIA DISPONIBLE": "", "HORA DISPONIBLE": "", "Modalidad": "" };
                const dia = dias[index % dias.length];
                const hora = horariosDisponibles[index % horariosDisponibles.length];
                const paralelo = "A";
                const nroHoras = Number(fila["HORAS TEÓRICAS"] || 0) + Number(fila["HORAS PRÁCTICAS"] || 0) + Number(fila["HORAS AUTÓNOMAS"] || 0);

                tablaHTML += `<tr>
                    <td>${docente["DOCENTE"]}</td>
                    <td>${docente["TITULO ACADÉMICO"]}</td>
                    <td>${docente["DEDICACION"]}</td>
                    <td>${materia}</td>
                    <td>${fila["CÓDIGO"]}</td>
                    <td>${fila["CARRERA"]}</td>
                    <td>${fila["MALLA"]}</td>
                    <td>${fila["PRERREQUISITO"]}</td>
                    <td>${fila["CÓDIGO"]}</td>
                    <td>${fila["HORAS TEÓRICAS"]}</td>
                    <td>${fila["HORAS PRÁCTICAS"]}</td>
                    <td>${fila["HORAS AUTÓNOMAS"]}</td>
                    <td>${fila["CRÉDITOS"]}</td>
                    <td>${fila["CAMPO DE FORMACIÓN"]}</td>
                    <td>${fila["CICLO"]}</td>
                    <td>${fila["NUMERO DE ORDEN EN LA MALLA"]}</td>
                    <td>${paralelo}</td>
                    <td>${dia}</td>
                    <td>${hora}</td>
                    <td>${docente["Modalidad"]}</td>
                    <td>${nroHoras}</td>
                </tr>`;
            });

            tablaHTML += "</tbody></table>";
            document.getElementById("tablaContainer").innerHTML = tablaHTML;
        });
    });
}
</script>
</body>
</html>
